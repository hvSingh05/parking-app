<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ user.name }}'s Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
</head>
<body class="container mt-5 mb-5 bg-dark text-white">

  <nav class="navbar d-flex justify-content-between">
    <h2>Welcome, {{ user.name }}</h2>
    <a href="/edit_profile/{{user.id}}" class="btn fs-4 text-white">Edit Profile</a>
    <a href="/logout" class="btn btn-danger fs-4 text-white">Logout</a>
  </nav>
  <hr>

  <main class="container mt-5">
    
    <div class="container mt-5">
      {% with messages = get_flashed_messages() %}
      {% if messages %}
      <div class="alert alert-info">
        {% for message in messages %}
        <p>{{ message }}</p>
        {% endfor %}
      </div>
      {% endif %}
      {% endwith %}

      {%if reservations%}
      <h3 class="text-center">Your Reservations</h3>
      <hr>
      
      <table class="table table-bordered table-striped mt-4">
        <thead class="table-dark">
          <tr>
            <th>Lot ID</th> 
            <th>Location</th>
            <th>Spot ID</th>
            <th>Vehicle Registration</th>
            <th>Reservation Time</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for reservation in reservations %}
          <tr>
            <td>{{ reservation.l_id }}</td>
            <td>{{ reservation.lot.loc }}</td>
            <td>{{ reservation.spot.spot_number }}</td>
            <td>{{ reservation.reg_num }}</td>
            <td>{{ reservation.start_time.strftime('%H:%M:%S') }}</td>
            <td>
              {% if reservation.end_time %}
              <button disabled="disabled" class="btn btn-success">Parked Out</button>
              {% else %}
              <a href="/release_spot/{{user.id}}/{{ reservation.id }}" class="btn btn-danger">Release Spot</a>
              
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {%else%}
      <h2 class="mb-3 text-center">No reservations!</h2>
      <hr>
      {%endif%}

    </div>
    
    <div class="container mt-5">

      <h3 class="text-center">Book a Parking Lot</h3>
      <hr>
      
      
      
      <form method="GET" action="/user_dashboard/{{user.id}}" class="mb-4">
        <label class="form-label">Select Parking Lot:</label>
        <div>
          <select name="lot_id" class="form-select">
            <option disabled selected value="">-- Select a lot --</option>
            {% for p_lot in lots %}
            <option value="{{ p_lot.id }}" {% if lot and p_lot.id == lot.id %}selected{% endif %}>
              {{ p_lot.loc }}
            </option>
            {% endfor %}
          </select>
          <button type="submit" class="btn btn-info mt-3">Check available spots</button>
        </div>
      </form>
      
      
      <form method="POST" action="/user_dashboard/{{user.id}}">
        {% if lot  %}
          {%if spot%}
          <input type="hidden" name="lot_id" value="{{ lot.id }}">
          <p class="card-text">Lot ID:</p>
          <p class="form-control">{{ lot.id }}</p>
          <p class="card-text">Pincode:</p>
          <p class="form-control">{{ lot.pincode }}</p>
          <p class="card-text">Address:</p>
          <p class="form-control">{{ lot.address }}</p>
          <p class="card-text">Price (per hour):</p>
          <p class="form-control">â‚¹{{ lot.price_per_hour }}</p>
          <p class="card-text">Spot ID:</p>
          <p class="form-control">{{ spot.spot_number }}</p>

          
          <div class="mb-3">
            <label class="form-label">Vehicle Registration Number:</label>
            <input type="text" name="reg" class="form-control" required />
          </div>
          
          <button type="submit" class="btn btn-success mt-3">Reserve Spot</button>
          {%else%}
          <h2 class="color-danger">No spots availabe!</h2>
          <hr>

          {% endif %}
        {%endif%}
      </form>
    </div>
  </main>
</body>
</html>
